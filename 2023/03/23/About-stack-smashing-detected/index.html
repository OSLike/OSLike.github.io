

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/txbynq.jpg">
  <link rel="icon" href="/img/txbynq.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="OSLike">
  <meta name="keywords" content="">
  
    <meta name="description" content="GCC compiler has a compile parameter which named “stack-protector“, divided into 4 kinds,  “fstack-protector“, “fstack-protector-all“, “fstack-protector-strong“ and “fstack-protector-explicit“. These">
<meta property="og:type" content="article">
<meta property="og:title" content="About ***stack smashing detected***">
<meta property="og:url" content="http://example.com/2023/03/23/About-stack-smashing-detected/index.html">
<meta property="og:site_name" content="OSLike&#39;s Blog">
<meta property="og:description" content="GCC compiler has a compile parameter which named “stack-protector“, divided into 4 kinds,  “fstack-protector“, “fstack-protector-all“, “fstack-protector-strong“ and “fstack-protector-explicit“. These">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ts1.cn.mm.bing.net/th/id/R-C.6f24c717cbea681c7ff9a3775200fc3a?rik=Z5k42qGtBb5Ydw&riu=http%3a%2f%2farsenetang.com%2fimages%2flogo.jpg&ehk=oYmEy9T4nBZNWyNJ9qICb9a2tqRmr57tD0%2bdsw6dWFo%3d&risl=&pid=ImgRaw&r=0">
<meta property="article:published_time" content="2023-03-23T10:02:41.000Z">
<meta property="article:modified_time" content="2023-03-25T02:26:12.000Z">
<meta property="article:author" content="OSLike">
<meta property="article:tag" content="knowledge">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ts1.cn.mm.bing.net/th/id/R-C.6f24c717cbea681c7ff9a3775200fc3a?rik=Z5k42qGtBb5Ydw&riu=http%3a%2f%2farsenetang.com%2fimages%2flogo.jpg&ehk=oYmEy9T4nBZNWyNJ9qICb9a2tqRmr57tD0%2bdsw6dWFo%3d&risl=&pid=ImgRaw&r=0">
  
  
  
  <title>About ***stack smashing detected*** - OSLike&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"rTccdNadc9XbepHsHq0yeMEk-gzGzoHsz","app_key":"XSYHRE8TrMTHTcH1w137uSk9","server_url":"https://rtccdnad.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>OSLike</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://wllm1013.github.io/img/08067.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="About ***stack smashing detected***"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        OSLike
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-23 18:02" pubdate>
          2023年3月23日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          71 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">About ***stack smashing detected***</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2023年3月25日 上午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>GCC compiler has a compile parameter which named “<em>stack-protector</em>“, divided into 4 kinds,  “<em>fstack-protector</em>“, “<em>fstack-protector-all</em>“, “<em>fstack-protector-strong</em>“ and “<em>fstack-protector-explicit</em>“. These are used to protect the stack from being attack. When the program crash because of function “<em>__stack_chk_fail</em>“, you will receive “<strong>*** stack smashing detected ***: &lt;NameofProgram&gt; terminated\n</strong>“ and “SIGABRT” signal.</p>
<p>Today all we know that Canary as a random number can protect our program from stack exploitation, but now you may need to try to learn how “<em>__stack_chk_fail</em>“ make your program crash.</p>
<p>In this article, I will try to find out how “<em>__stack_chk_fail</em>“ make your program crash in common libc.</p>
<p>Note: </p>
<ol>
<li>We will explore this topic in <strong>GLIBC</strong>, which is the abbreviation of GNU C Library.</li>
<li>All the seemingly endless loops only want to make gcc “happy”, so that it can prevent gcc from reporing an error because of no retun occurs.</li>
<li>All subsequent content is compared to glibc-2.23 or the previous version.</li>
</ol>
<h2 id="glibc-2-23"><a href="#glibc-2-23" class="headerlink" title="glibc-2.23"></a>glibc-2.23</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/stack_chk_fail_local.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/cdefs.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> __stack_chk_fail (<span class="hljs-type">void</span>) __attribute__ ((<span class="hljs-keyword">noreturn</span>));<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) attribute_hidden<br>__stack_chk_fail_local (<span class="hljs-type">void</span>) &#123; __stack_chk_fail (); &#125;	<span class="hljs-comment">// call __stack_chk_fail</span><br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/stack_chk_fail.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> **__libc_argv attribute_hidden;<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>))<br>__stack_chk_fail (<span class="hljs-type">void</span>) &#123; __fortify_fail (<span class="hljs-string">&quot;stack smashing detected&quot;</span>); &#125; <span class="hljs-comment">// call __fortify_fail</span><br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/fortify_fail.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> **__libc_argv attribute_hidden;<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) internal_function<br>__fortify_fail (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)&#123;<br>   	<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) <br>    __libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">&quot;*** %s ***: %s terminated\n&quot;</span>, <span class="hljs-comment">/* use 2 for stderr */</span><br>		    msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>);	<span class="hljs-comment">// call __libc_message</span><br>&#125;<br>libc_hidden_def (__fortify_fail)	<span class="hljs-comment">// using libc_hidden_def, is not useful enough in this topc</span><br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// sysdeps/posix/libc_fatal.c</span><br><span class="hljs-type">void</span> __libc_message (<span class="hljs-type">int</span> do_abort, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *fmt, ...) &#123;<br>  va_list ap;<br>  <span class="hljs-type">int</span> fd = <span class="hljs-number">-1</span>;<br>    <br>  va_start (ap, fmt);<br>    <br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> FATAL_PREPARE</span><br>  FATAL_PREPARE;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <br>  <span class="hljs-comment">/* Open a descriptor for /dev/tty unless the user explicitly</span><br><span class="hljs-comment">     requests errors on standard error.  */</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *on_2 = __libc_secure_getenv (<span class="hljs-string">&quot;LIBC_FATAL_STDERR_&quot;</span>);<br>  <span class="hljs-keyword">if</span> (on_2 == <span class="hljs-literal">NULL</span> || *on_2 == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    fd = open_not_cancel_2 (_PATH_TTY, O_RDWR | O_NOCTTY | O_NDELAY);<br><br>  <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>)<br>    fd = STDERR_FILENO;<br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">str_list</span> *<span class="hljs-title">list</span> =</span> <span class="hljs-literal">NULL</span>;<br>  <span class="hljs-type">int</span> nlist = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *cp = fmt;<br>  <span class="hljs-keyword">while</span> (*cp != <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Find the next &quot;%s&quot; or the end of the string.  */</span><br>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *next = cp;<br>      <span class="hljs-keyword">while</span> (next[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;%&#x27;</span> || next[<span class="hljs-number">1</span>] != <span class="hljs-string">&#x27;s&#x27;</span>)<br>	&#123;<br>	  next = __strchrnul (next + <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;%&#x27;</span>);<br><br>	  <span class="hljs-keyword">if</span> (next[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>	    <span class="hljs-keyword">break</span>;<br>	&#125;<br>      <span class="hljs-comment">/* Determine what to print.  */</span><br>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *str;<br>      <span class="hljs-type">size_t</span> len;<br>      <span class="hljs-keyword">if</span> (cp[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;%&#x27;</span> &amp;&amp; cp[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;s&#x27;</span>)<br>	&#123;<br>	  str = va_arg (ap, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *);<br>	  len = <span class="hljs-built_in">strlen</span> (str);<br>	  cp += <span class="hljs-number">2</span>;<br>	&#125;<br>      <span class="hljs-keyword">else</span><br>	&#123;<br>	  str = cp;<br>	  len = next - cp;<br>	  cp = next;<br>	&#125;<br>      <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">str_list</span> *<span class="hljs-title">newp</span> =</span> alloca (<span class="hljs-keyword">sizeof</span> (<span class="hljs-keyword">struct</span> str_list));<br>      newp-&gt;str = str;<br>      newp-&gt;len = len;<br>      newp-&gt;next = <span class="hljs-built_in">list</span>;<br>      <span class="hljs-built_in">list</span> = newp;<br>      ++nlist;<br>    &#125;<br><br>  <span class="hljs-type">bool</span> written = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">if</span> (nlist &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iovec</span> *<span class="hljs-title">iov</span> =</span> alloca (nlist * <span class="hljs-keyword">sizeof</span> (<span class="hljs-keyword">struct</span> iovec));<br>      <span class="hljs-type">ssize_t</span> total = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> cnt = nlist - <span class="hljs-number">1</span>; cnt &gt;= <span class="hljs-number">0</span>; --cnt)<br>	&#123;<br>	  iov[cnt].iov_base = (<span class="hljs-type">char</span> *) <span class="hljs-built_in">list</span>-&gt;str;<br>	  iov[cnt].iov_len = <span class="hljs-built_in">list</span>-&gt;len;<br>	  total += <span class="hljs-built_in">list</span>-&gt;len;<br>	  <span class="hljs-built_in">list</span> = <span class="hljs-built_in">list</span>-&gt;next;<br>	&#125;<br><br>      written = WRITEV_FOR_FATAL (fd, iov, nlist, total);<br><br>      <span class="hljs-keyword">if</span> (do_abort)<br>	&#123;<br>	  total = ((total + <span class="hljs-number">1</span> + GLRO(dl_pagesize) - <span class="hljs-number">1</span>)<br>		   &amp; ~(GLRO(dl_pagesize) - <span class="hljs-number">1</span>));<br>	  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">abort_msg_s</span> *<span class="hljs-title">buf</span> =</span> __mmap (<span class="hljs-literal">NULL</span>, total,<br>					    PROT_READ | PROT_WRITE,<br>					    MAP_ANON | MAP_PRIVATE, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>	  <span class="hljs-keyword">if</span> (__glibc_likely (buf != MAP_FAILED))<br>	    &#123;<br>	      buf-&gt;size = total;<br>	      <span class="hljs-type">char</span> *wp = buf-&gt;msg;<br>	      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> cnt = <span class="hljs-number">0</span>; cnt &lt; nlist; ++cnt)<br>		wp = mempcpy (wp, iov[cnt].iov_base, iov[cnt].iov_len);<br>	      *wp = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>	      <span class="hljs-comment">/* We have to free the old buffer since the application might</span><br><span class="hljs-comment">		 catch the SIGABRT signal.  */</span><br>	      <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">abort_msg_s</span> *<span class="hljs-title">old</span> =</span> atomic_exchange_acq (&amp;__abort_msg,<br>							     buf);<br>	      <span class="hljs-keyword">if</span> (old != <span class="hljs-literal">NULL</span>)<br>		__munmap (old, old-&gt;size);<br>	    &#125;<br>	&#125;<br>    &#125;<br><br>  va_end (ap);<br><br>  <span class="hljs-keyword">if</span> (do_abort)<br>    &#123;<br>      BEFORE_ABORT (do_abort, written, fd);<br>      <span class="hljs-comment">/* Kill the application.  */</span><br>      <span class="hljs-built_in">abort</span> ();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Then in “<em>sysdeps&#x2F;posix&#x2F;libc_fatal.c</em>“ we can find function “<em>__libc_message</em>“. If we call this function, the envionment variables which named “<em>LIBC_FATAL_STDERR_</em>“ will be scand with function “<em>__libc_secure_gentenv</em>“, if the value of “<em>LIBC_FATAL_STDERR_</em>“ is ‘\0’ or NULL, stderr will be redirected to “<em>_PATH_TTY</em>‘’, which value is always the path “<em>&#x2F;dev&#x2F;tty</em>“, so the stderr will be printed in terminal. So even thought there is a “while(1)” in “<em>__fortify_fail</em>“ look like an endless loop, it’s not.</p>
<p>After such these calls, msg and __libc_argv[0] or “&lt;unknown&gt;“ will be printed out in the terminal.</p>
<h2 id="glibc-2-25"><a href="#glibc-2-25" class="headerlink" title="glibc-2.25"></a>glibc-2.25</h2><p>“<em>&#x2F;debug&#x2F;stack_chk_fail.c</em>“ is same to the file in the same location in glibc-2.23.</p>
<p>In “<em>&#x2F;debug&#x2F;stack_chk_fail.c</em>“, they finally add<code>strong_alias (__stack_chk_fail, __stack_chk_fail_local)</code> but it is still not useful enough to explian in this topic.</p>
<p>But function “<em>__libc_message</em>“in “<em>sysdeps&#x2F;posix&#x2F;libc_fatal.c</em>“ has some difference to the file in the same location in glibc-2.23.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// include/stdio.h</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> __<span class="hljs-title">libc_message_action</span></span><br><span class="hljs-class">&#123;</span><br>  do_message	= <span class="hljs-number">0</span>,		<span class="hljs-comment">/* Print message.  */</span><br>  do_abort	= <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">0</span>,	<span class="hljs-comment">/* Abort.  */</span><br>  do_backtrace	= <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">1</span>	<span class="hljs-comment">/* Backtrace.  */</span><br>&#125;; <span class="hljs-comment">// do_message=0, do_abort=1, do_backtrace=2</span><br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// sysdeps/posix/libc_fatal.c</span><br><span class="hljs-type">void</span> __libc_message (<span class="hljs-keyword">enum</span> __libc_message_action action, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *fmt, ...) &#123;<br>  <br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  	same to glibc-2.23</span><br><span class="hljs-comment">  */</span><br>  <br>  <span class="hljs-comment">/* Don&#x27;t call __libc_secure_getenv if we aren&#x27;t doing backtrace, which</span><br><span class="hljs-comment">     may access the corrupted stack.  */</span><br>  <span class="hljs-keyword">if</span> ((action &amp; do_backtrace)) <span class="hljs-comment">// In comments, we can clarify the creator&#x27;s intention.</span><br>    &#123; <span class="hljs-comment">// It does not matter a lot of time actually</span><br>      <span class="hljs-comment">/* Open a descriptor for /dev/tty unless the user explicitly</span><br><span class="hljs-comment">	 requests errors on standard error.  */</span><br>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *on_2 = __libc_secure_getenv (<span class="hljs-string">&quot;LIBC_FATAL_STDERR_&quot;</span>);<br>      <span class="hljs-keyword">if</span> (on_2 == <span class="hljs-literal">NULL</span> || *on_2 == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>	fd = __open_nocancel (_PATH_TTY, O_RDWR | O_NOCTTY | O_NDELAY);<br>    &#125;<br>    <br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  	same to glibc-2.23</span><br><span class="hljs-comment">  */</span><br>    <br>  <span class="hljs-keyword">while</span> (*cp != <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    &#123;<br>      <span class="hljs-comment">/*</span><br><span class="hljs-comment">      	same to glibc-2.23</span><br><span class="hljs-comment">      */</span><br>  	<span class="hljs-keyword">if</span> ((action &amp; do_abort))<br>    &#123;<br>      <span class="hljs-keyword">if</span> ((action &amp; do_backtrace))<br>		BEFORE_ABORT (do_abort, written, fd);<br>      	<span class="hljs-comment">/* Kill the application.  */</span><br>      	<span class="hljs-built_in">abort</span> ();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Relatively little difference, but it does become more standardized.</p>
<h2 id="glibc-2-27"><a href="#glibc-2-27" class="headerlink" title="glibc-2.27"></a>glibc-2.27</h2><p>“<em>&#x2F;debug&#x2F;stack_chk_fail.c</em>“ is same to the file in the same location in glibc-2.23.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/stack_chk_fail.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> **__libc_argv attribute_hidden;<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>))<br>__stack_chk_fail (<span class="hljs-type">void</span>) &#123; __fortify_fail_abort (<span class="hljs-literal">false</span>, <span class="hljs-string">&quot;stack smashing detected&quot;</span>); &#125;<br>strong_alias (__stack_chk_fail, __stack_chk_fail_local)<br></code></pre></td></tr></table></figure>

<p>We see that the function who calls the string “stack smashing detected” is changed into “<em>__fortify_fail_abort</em>“ and another parament “false” is added, which is imported from header “<em>stdboo.h</em>“.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/fortify_fail.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> **__libc_argv attribute_hidden;<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>))<br>__fortify_fail_abort (<span class="hljs-type">_Bool</span> need_backtrace, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg) &#123;<br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    __libc_message (need_backtrace ? (do_abort | do_backtrace) : do_abort,<br>		    <span class="hljs-string">&quot;*** %s ***: %s terminated\n&quot;</span>, msg,<br>		    (need_backtrace &amp;&amp; __libc_argv[<span class="hljs-number">0</span>] != <span class="hljs-literal">NULL</span><br>		     ? __libc_argv[<span class="hljs-number">0</span>] : <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>));<br>&#125;<br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) __fortify_fail (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg) &#123;<br>  __fortify_fail_abort (<span class="hljs-literal">true</span>, msg);<br>&#125;<br>libc_hidden_def (__fortify_fail)<br>libc_hidden_def (__fortify_fail_abort)<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// include/stdio.h</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> __<span class="hljs-title">libc_message_action</span></span><br><span class="hljs-class">&#123;</span><br>  do_message	= <span class="hljs-number">0</span>,		<span class="hljs-comment">/* Print message.  */</span><br>  do_abort	= <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">0</span>,	<span class="hljs-comment">/* Abort.  */</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>In this glibc version, publisher add a boolean number whose name is need_backtrace, so that we can use this to avoid doing backtrace since “<em>__libc_argv[0]</em>“ may point to the corrupted stack.</p>
<p>“<em>__libc_message</em>“ is same to glibc-2.25.</p>
<p>So glibc-2.27 is more secure about whether backtrace is needed in function”<em>__libc_message</em>“.</p>
<h2 id="glibc-2-31-x2F-glibc-2-35-x2F-glibc-2-36"><a href="#glibc-2-31-x2F-glibc-2-35-x2F-glibc-2-36" class="headerlink" title="glibc-2.31&#x2F;glibc-2.35&#x2F;glibc-2.36"></a>glibc-2.31&#x2F;glibc-2.35&#x2F;glibc-2.36</h2><p>“<em>&#x2F;debug&#x2F;stack_chk_fail.c</em>“ is same to the file in the same location in glibc-2.23.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/stack_chk_fail.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) __stack_chk_fail (<span class="hljs-type">void</span>)<br>&#123; __fortify_fail (<span class="hljs-string">&quot;stack smashing detected&quot;</span>); &#125;<br>strong_alias (__stack_chk_fail, __stack_chk_fail_local)<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// debug/fortify_fail.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> __attribute__ ((<span class="hljs-keyword">noreturn</span>)) __fortify_fail (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)<br>&#123; <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) __libc_message (do_abort, <span class="hljs-string">&quot;*** %s ***: terminated\n&quot;</span>, msg); &#125;<br>libc_hidden_def (__fortify_fail)<br></code></pre></td></tr></table></figure>

<p>Something wrong? Why is there less code this time? It was as if times had gone backwards!</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// sysdeps/posix/libc_fatal.c</span><br><span class="hljs-type">void</span> __libc_message (<span class="hljs-keyword">enum</span> __libc_message_action action, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *fmt, ...)<br>&#123;<br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">    same to glibc-2.23</span><br><span class="hljs-comment">  */</span><br>  <span class="hljs-keyword">if</span> (nlist &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-comment">/*</span><br><span class="hljs-comment">        same to glibc-2.23</span><br><span class="hljs-comment">      */</span><br>	&#125;<br>    <span class="hljs-comment">/* remove written = */</span><br>      WRITEV_FOR_FATAL (fd, iov, nlist, total);<br><br>      <span class="hljs-keyword">if</span> ((action &amp; do_abort))<br>	&#123;<br>	  <span class="hljs-comment">/*</span><br><span class="hljs-comment">      same to glibc-2.25</span><br><span class="hljs-comment">      */</span><br>  <span class="hljs-keyword">if</span> ((action &amp; do_abort))<br>    <span class="hljs-comment">/* Kill the application.  */</span><br>    <span class="hljs-built_in">abort</span> ();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>In glibc-2.31 the publisher removed the following relative to glibc-2.27:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Open a descriptor for /dev/tty unless the user explicitly</span><br><span class="hljs-comment">     requests errors on standard error.  */</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *on_2 = __libc_secure_getenv (<span class="hljs-string">&quot;LIBC_FATAL_STDERR_&quot;</span>);<br>  <span class="hljs-keyword">if</span> (on_2 == <span class="hljs-literal">NULL</span> || *on_2 == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    fd = open_not_cancel_2 (_PATH_TTY, O_RDWR | O_NOCTTY | O_NDELAY);<br></code></pre></td></tr></table></figure>

<p>Because they remove<code>BEFORE_ABORT (do_abort, written, fd);</code>, these operations are no longer effective and fd is not fully effective.</p>
<p>So you can probably tell that some of the code in glibc-2.31 has been optimized to improve readability and usability without changing security. But it doesn’t change the attacker’s operations much.</p>
<h2 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h2><p>After all is said and done, as an ELF file is running, it’s filename will be saved into the loader, and before the first rbp register. So if we can get the length from the current input position to the address of argv[0], we can use stack smash attach to get the modified value of “argv[0]”.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Computer/" class="category-chain-item">Computer</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/knowledge/">#knowledge</a>
      
        <a href="/tags/pwn/">#pwn</a>
      
        <a href="/tags/CTF/">#CTF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>About ***stack smashing detected***</div>
      <div>http://example.com/2023/03/23/About-stack-smashing-detected/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>OSLike</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年3月23日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/25/%E5%85%B3%E4%BA%8Eglibc-SSP%E5%8F%91%E7%94%9F%E6%96%B9%E5%BC%8F%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E4%B8%AD%E7%9A%84%E7%A0%94%E7%A9%B6/" title="关于glibc-SSP发生方式在不同版本中的研究">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">关于glibc-SSP发生方式在不同版本中的研究</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/21/%E5%A0%86%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%B0%8F%E6%95%B4%E7%90%86/" title="堆相关数据结构小整理">
                        <span class="hidden-mobile">堆相关数据结构小整理</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>OSLike</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>WEplayerscsc</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人      
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
